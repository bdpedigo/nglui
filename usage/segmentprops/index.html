
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://caveconnectome.github.io/nglui/usage/segmentprops/">
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../statebuilder/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>Segment Properties - NGLui Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.76a95c52.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:300,300i,400,400i,700,700i%7CInconsolata:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Bitter";--md-code-font:"Inconsolata"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#basics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NGLui Documentation" class="md-header__button md-logo" aria-label="NGLui Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NGLui Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Segment Properties
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/CAVEconnectome/nglui/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    CAVEconnectome/NGLui
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  How to Use

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/segmentprops/" class="md-tabs__link">
          
  
    
  
  Function Reference

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NGLui Documentation" class="md-nav__button md-logo" aria-label="NGLui Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    NGLui Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CAVEconnectome/nglui/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    CAVEconnectome/NGLui
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    How to Use
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            How to Use
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Segment Properties
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Segment Properties
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    <span class="md-ellipsis">
      Basics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-segment-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Building segment properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building segment properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tag-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Tag properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#number-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Number properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-segment-properties-manually" class="md-nav__link">
    <span class="md-ellipsis">
      Building segment properties manually
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-segment-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Saving segment properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Saving segment properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-a-cave-state-server-endpoint-to-upload-properties" class="md-nav__link">
    <span class="md-ellipsis">
      1. Use a CAVE state server endpoint to upload properties.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-save-the-properties-to-a-file-web-accessible-location" class="md-nav__link">
    <span class="md-ellipsis">
      2. Save the properties to a file web-accessible location.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-segment-properties-to-neuroglancer" class="md-nav__link">
    <span class="md-ellipsis">
      Adding segment properties to Neuroglancer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-properties-in-statebuilder" class="md-nav__link">
    <span class="md-ellipsis">
      Segment properties in StateBuilder.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment properties in StateBuilder.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#segment-property-maps" class="md-nav__link">
    <span class="md-ellipsis">
      Segment property maps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../statebuilder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StateBuilder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Parser
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../reference/segmentprops/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Function Reference
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Segment Properties</h1>

<p>Segment properties are a method of organizing information about segment IDs in the current Google/Spelunker version of Neuroglancer.
Each segmentation layer can have at most one set of segment properties, expressed as an additional <code>source</code> for the layer.
The segment properties themselves are simply a JSON file following a <a href="https://github.com/google/neuroglancer/blob/master/src/datasource/precomputed/segment_properties.md">particular specification</a>, that allows you to associate labels, descriptions, tags, and numerical values with each segment ID.</p>
<h2 id="basics">Basics</h2>
<p>Segment properties consist of a list of segment IDs and a collection of properties for each ID in the list.
There are four types of properties that can be viewed in Neuroglancer:</p>
<ul>
<li><strong>Label</strong>: A string that names each segment ID. Only one per ID per property list.</li>
<li><strong>Description</strong>: A longer description of each segment ID. Only one per ID per property list.</li>
<li><strong>Tags</strong>: A small collection of strings that can be used to filter segments. There can be more than one tag per ID.</li>
<li><strong>Number</strong>: Numeric properties (e.g. depth, synapse count) for each cell. There can be more than one numeric property provided.</li>
</ul>
<p>In addition, the specification allows <em>string properties</em>, but these are not currently shown in Neuroglancer.</p>
<figure>
  <img alt="Image title" src="../seg_props.png" width="500" />
  <figcaption>Segment properties help make Neuroglancer more browsable from data</figcaption>
</figure>
<h2 id="building-segment-properties">Building segment properties</h2>
<p>The easiest way to work with segment properties is to build them from a dataframe.
The only absolute requirement is that the dataframe has a column associated with segment IDs.
For example, assume we have a pandas dataframe <code>df</code> with columns <code>segment_id</code>, <code>soma_depth</code>, and <code>cell_type</code> with some data in them.
We can use the <code>SegmentProperties.from_dataframe</code> method to build a <code>SegmentProperties</code> object from this dataframe.
In this case, we want <code>soma_depth</code> to be a numeric property and the values  <code>cell_type</code> to be a tag.</p>
<pre><code class="language-python">import pandas as pd
from nglui.segmentprops import SegmentProperties

df = pd.DataFrame(
    {'segment_id': [1, 2, 3],
     'soma_depth': [100, 200, 300],
     'cell_type': ['pyramidal_cell', 'interneuron', 'interneuron']}
)

seg_prop = SegmentProperties.from_dataframe(
    df,
    id_col='segment_id',
    number_cols='soma_depth',
    tag_value_cols='cell_type'
)
</code></pre>
<p>To get a formatted segment proerties, you can use the <code>to_dict</code> method:</p>
<pre><code class="language-python">seg_prop.to_dict()
</code></pre>
<p>which will produce something like:</p>
<pre><code class="language-json">{'@type': 'neuroglancer_segment_properties',
 'inline': {'ids': ['1', '2', '3'],
  'properties': [{'id': 'tags',
    'type': 'tags',
    'tags': ['interneuron', 'pyramidal_cell'],
    'values': [[1], [0], [0]]},
   {'id': 'soma_depth',
    'type': 'number',
    'values': [100, 200, 300],
    'data_type': 'int32'}]}}
</code></pre>
<p>Note that multiple numeric properties can be passed a list of column names.</p>
<h3 id="tag-properties">Tag properties</h3>
<p>There are two ways to associate tags with segment IDs.
When using the <code>tag_value_cols</code> argument, the unique values (except <code>None</code>) across all specified columns are used as tags.
Values that are duplicated across different columns will be counted as a single tag.
For tag value columns, the order is determined by the sorting of values.
By default, this is alphabetical, but it will follow the order from <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html">categorical data</a> in pandas.</p>
<p>If you need more fine control over the tags, you can use the <code>tag_bool_cols</code> argument.
Here, a column name or list of column names are passed with the expectation that each <em>column name</em> represents a tag and if the value of a given row is <code>True</code>, the tag is associated with the segment ID.
Here, the order will follow the order of the list.</p>
<p>Both <code>tag_value_cols</code> and <code>tag_bool_cols</code> can be used together, with the order being values followed by boolean columns.</p>
<p>You can also specify <code>tag_descriptions</code>, a dictionary where the tag names are the keys and longer-form descriptions are the values.
Any tag without a description will be passed through directly.</p>
<h3 id="number-properties">Number properties</h3>
<p>If you look at the JSON output above, you see that the <code>soma_depth</code> property has a field "data_type" that specifies the type of the numerical property, in this case <code>int32</code>.
Data type values are inferred from the column dtype and safe conversions are validated.</p>
<h3 id="building-segment-properties-manually">Building segment properties manually</h3>
<p>It is also possible to build segment properties manually with the <code>SegmentProperties</code> class.
Each type of property is represented by a different class: <code>LabelProperty</code>, <code>DescriptionProperty</code>, <code>TagProperty</code>, and <code>NumberProperty</code>.
Each property type has required and optional arguments that are used to build the property.
More details can be found in the <a href="../../reference/segmentprops/">API reference</a>.
You can then either build a SegmentProperties object from these properties, for example:</p>
<pre><code class="language-python">from nglui.segmentprops import SegmentProperties, LabelProperty, NumberProperty

labels = LabelProperty(values=['cell_1', 'cell_2', 'cell_3'])
numbers = NumberProperty(
    id='hugeness',
    values=[1,2,3],
    data_type='float32',
)
props = SegmentProperties(
    ids = [1,2,3],
    label_property=labels,
    number_properties=numbers, # Could be a list of NumberProperty objects as well.
)
</code></pre>
<p>Note that validation happens on the <code>to_dict</code> method, so you can build invalid properties (such as different-length lists of ids and property values) without error.</p>
<h2 id="saving-segment-properties">Saving segment properties</h2>
<p>Segment properties must be hosted on a server to be used in Neuroglancer.
There are two main approaches to this:</p>
<h4 id="1-use-a-cave-state-server-endpoint-to-upload-properties">1. Use a CAVE state server endpoint to upload properties.</h4>
<p>The CAVE state server has a special endpoint you can use to upload segment properties.
After initializing a <code>CAVEclient</code> object, you first upload the properties with the <code>upload_property_json</code> method and then build a link from the resulting id you get back.</p>
<pre><code class="language-python">from caveclient import CAVEclient
client = CAVEclient('MY_DATASTACK')
ngl_url = &quot;https://neuroglancer-demo.appspot.com&quot;

prop_id = state.upload_property_json(seg_prop.to_dict())
prop_url = client.state.build_neuroglancer_url(prop_id, ngl_url=ngl_url, format_properties=True)
</code></pre>
<p>You will then use the resulting URL in the <code>source</code> field of a segmentation layer in Neuroglancer.</p>
<p>This approach is convenient, but there is a limit to how large the properties list can be.
In addition, you do not get to choose a readable URL for the properties and they must be behind CAVE authentication.</p>
<h4 id="2-save-the-properties-to-a-file-web-accessible-location">2. Save the properties to a file web-accessible location.</h4>
<p>For large properties or properties you want to be publicly accessible, you can save the properties to a file and host them on a web-accessible location with a particular organization.</p>
<p>First, save the properties to a file called <code>info</code> (no extensions!)</p>
<pre><code class="language-python">import json

with open('info', 'w') as f:
    json.dump(props.to_dict(), f) 
</code></pre>
<p>Next, create a directory in a web-accessible location (e.g. <code>https://my-server/my-property</code>) or public cloud bucket (e.g. <code>gs://my-bucket/my-property</code>) and upload the <code>info</code> file to that directory.</p>
<p>The URL you will use to load the properties into Neuroglancer will be <code>precomputed://</code> followed by the URL of the directory or bucket (e.g. <code>precomputed://https://my-server/my-property</code> or <code>precomputed://gs://my-bucket/my-property</code>).</p>
<h4 id="adding-segment-properties-to-neuroglancer">Adding segment properties to Neuroglancer</h4>
<p>If saved segment properties with either of the two methods above, you will get a URL that you can load into Neuroglancer as a source for a segmentation layer.
If you want to do this manually in a browser you have already have open, select the segmentation layer, go to the source tab, and click the <code>+</code> button to add a new source and paste the URL in.</p>
<h2 id="segment-properties-in-statebuilder">Segment properties in StateBuilder.</h2>
<p>The <code>StateBuilder</code> class lets you set either static segment properties or segment properties that are generated from a dataframe.</p>
<p>To set static segment properties from a hosted JSON file, you simply set a segment properties value on the SegmentationLayerConfig.</p>
<pre><code class="language-python">from nglui import statebuilder

seg = statebuilder.SegmentationLayerConfig(
    source=&quot;precomputed://gs://my-bucket/my-segmentation&quot;,
    segment_properties='precomputed://https://my-server/my-property',
)
</code></pre>
<p>and proceed to build the state as normal.</p>
<h4 id="segment-property-maps">Segment property maps</h4>
<p>Alternatively, you can set segment properties from data when you render the state.
Here, we have to create the segmentation layer first and then set the segment property mapping on the layer.</p>
<pre><code class="language-python">seg = statebuilder.SegmentationLayerConfig(
    source=&quot;precomputed://gs://my-bucket/my-segmentation&quot;,


seg.add_segment_properties_map(
    label_col='id_ref',
    tag_value_cols=['cell_type', 'classification_system'],
    number_cols=['soma_depth'],
)
</code></pre>
<p>The arguments follow the <code>SegmentProperties.from_dataframe</code> method.
Segment property maps require a CAVEclient to be set when building the StateBuilder object, as the resulting properties need to be uploaded to the CAVE state server.
In addition, if you want to use a different dataframe for segment properties than for data, you can specfify a <code>mapping_set</code>.
Mapping sets are found throughout StateBuilder, and let you pass a dictionary of dataframes to use for different purposes, where the keys are these mapping set values.
Note that if you use a mapping set anywhere, you have to specify them for all data rules in the state.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.instant", "navigation.prune", "navigation.tabs", "navigation.tabs.sticky", "toc.follow", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "header.autohide"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>